<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Service</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2 style="text-align:center;">Book Service</h2>

<form id="bookingForm" class="form">
  <input type="text" id="service" placeholder="Service" readonly>
  <input type="text" id="subService" placeholder="Sub Service" readonly>

  <input type="text" id="name" placeholder="Your Name" required>
  <input type="email" id="email" placeholder="Email">
  <input type="tel" id="phone" placeholder="Phone Number" required>

  <textarea id="description" placeholder="Describe your problem" required></textarea>

  <button type="submit">Submit Booking</button>

  <p id="message" style="margin-top:15px;text-align:center;"></p>
</form>

<script>
  // Autofill service & sub-service from URL
  const params = new URLSearchParams(window.location.search);
  document.getElementById("service").value = params.get("service");
  document.getElementById("subService").value = params.get("sub");

  // Handle form submit
  document.getElementById("bookingForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const data = {
      service: document.getElementById("service").value,
      subService: document.getElementById("subService").value,
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      phone: document.getElementById("phone").value,
      description: document.getElementById("description").value
    };

    try {
      const response = await fetch("http://localhost:5000/api/bookings", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (response.ok) {
        document.getElementById("message").style.color = "#22d3ee";
        document.getElementById("message").innerText = "✅ Booking submitted successfully!";
        document.getElementById("bookingForm").reset();
      } else {
        document.getElementById("message").style.color = "red";
        document.getElementById("message").innerText = result.message;
      }

    } catch (error) {
      document.getElementById("message").style.color = "red";
      document.getElementById("message").innerText = "❌ Server error. Try again.";
    }
  });
</script>

</body>
</html>
